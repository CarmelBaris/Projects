---
title: "Lecture3_Copy_v2"
author: "Yuval Benjamini (Carmel Edit)"
date: Sys.Date()
output:
  html_document:
    code_folding: show
  pdf_document: default
editor_options:
  markdown:
    wrap: sentence
---

```{r}
library('data.table')
library('tictoc')
library('dplyr')
```

Load data...
```{r paths}

helpers = '~/Carmel/RProjects/Lab_Benjamini/task3/help_funcs.R'
source(helpers)

# Benjamini:
# reads_file = '~/Carmel/RProjects/Lab_Benjamini/data/TCGA-13-0723-10B_lib2_all_chr1.forward'
# Group A:
reads_file = '~/Carmel/RProjects/Lab_Benjamini/data/TCGA-13-0723-01A_lib2_all_chr1.forward'

chr1_reads_orig = fread(reads_file) 
colnames(chr1_reads_orig) = c("Chrom","Loc","FragLen")   


```

You should have a file of "helper functions" that you call using `source("functions.R")`. 

# Uniform Poisson model

This week we explored the distribution of DNA-sequenced fragments. \n
By definition, locations accept only integers and therefore behave like a discrete random variable. \n 
In particular, locations along a given chromosome sequence behave like a random variable from a Poisson distribution.

First, let us produce many instances of uniform variables:
```{r}
set.seed(1)
nsamp = 100e+06 # 100M
max_samp = nsamp * 10
unif_dat = runif(n = nsamp, 0,max_samp )
s_dat = sort(unif_dat)
```

We get the Poisson by counting occurrences in equal-size intervals, 
  as defined by the bin size (denoted $k$). \n
Since the intervals are of equal size, 
  we expect there will be an equal chance to end up in any of the bins. \n
In other words, we expect to have an average of one occurrence per bin. \n


```{r}
k = 1000
out_clean = range(output_1K,na.rm = TRUE) #excludes NA
clean_lo = out_clean[1] - 2
clean_up = out_clean[2]
hist(output_1K,seq(clean_lo,clean_up,4),freq = FALSE) #density

pois_probs = dpois(x = 60:147, lambda = 1000/10)
pois_probs_4s = rowMeans(matrix(pois_probs,byrow = TRUE,nc = 4))
points(seq(60,147,4),pois_probs_4s)
```


## Comparing the Poisson model to coverage

```{r}

# get read line of actual data
beg_region = 1
end_region = 10e06
locations = chr1_reads_orig$Loc
N = end_region-beg_region+1


brks=40
read_line = getReadLine(locations, beg_region, end_region)
read_hist = hist(read_line,breaks = 0:brks-0.5, plot = FALSE)

# define y-axis limits
y_lim <- c(0, max(read_hist$counts) * 1.1)

# plot the histogram without y-axis
plot(read_hist, ylim = y_lim, yaxt = "n", 
     main = "Number of Chrom1 Locations Containing X Reads",
     xlab = "Read Count (Per Location)", 
     ylab = "Location Count")

# format y-axis labels
y_ticks <- axTicks(2)
formatted_y_ticks <- sapply(y_ticks, formatLabels)
axis(2, at = y_ticks, labels = formatted_y_ticks)

# format histogram labels
formatted_counts <- sapply(read_hist$counts, formatLabels)

# add formatted labels to the histogram
text(read_hist$mids,
     read_hist$counts,
     formatted_counts,
     pos = 3, cex = 0.48)

# Preparing a coverage vector for bins of 5K...
obs_prob = read_hist$density

reads_20K = binReads(input = read_line,size = 20e+03)
pois_probs = dpois(0:660,mean(reads_20K))


```


## Comparison to poisson.
```{r}
# compute poisson probabilities and compare to observed probabilities...

# Compare these to the probabilities from the bulk. 
# What does this model imply for the probability of being between X_i in 100:109?
sd(reads_20K,na.rm=TRUE)

```


