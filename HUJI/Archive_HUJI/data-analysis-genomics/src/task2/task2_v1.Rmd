---
title: "Task2_Group6"
output: html_document
date: "2024-05-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library('ggplot2')
library('data.table')
library('manipulate')
library('tictoc')

# Group A file
reads_file = 'C:/Users/user/Documents/Carmel/Projects/HUJI/Archive_HUJI/data-analysis-genomics/data/TCGA-13-0723-10B_lib2_all_chr1.forward'
# reads_file = "/Users/alevi/Downloads/ATCGA-13-0723-01A_lib2_all_chr1.forward/TCGA-13-0723-01A_lib2_all_chr1.forward"
chr1_reads = fread(reads_file) 

```

Adding column names:
```{r}
colnames(chr1_reads) = c("Chrom","Loc","FragLen")   
head(chr1_reads)
```

Now take a look at a random sample
```{r}
chr1_reads[sample(nrow(chr1_reads),5)]

```

The function gets a vector of locations, start point and an end point, and produces a vector that for each base registers the number of fragments starting with the base-

```{r}
getReadLine = function(locations, beg_region, end_region) {
  # Initialize the vector to store the counts
  line = rep(0, end_region - beg_region + 1)
  
  # Loop through the locations and increment the count
  for (loc in locations) {
    if (loc >= beg_region && loc <= end_region) {
      line[loc - beg_region + 1] = line[loc - beg_region + 1] + 1
    }
  }
  
  return(line)
}
```
Now we'll run the vector on 20M bases-
```{r}

locations = chr1_reads$Loc

# Define the beginning and end of the region
beg_region = 1
end_region = 20000000

start_time <- proc.time()
line <- getReadLine(locations, beg_region, end_region)
end_time <- proc.time()

elapsed_time <- end_time - start_time

print(paste("Function run time:", round(elapsed_time["elapsed"],2), "seconds"))
print(paste("Number of fragments:", length(line)))

```

```{r}
# Convert vector to a data frame
read_counts_df <- data.frame(
  Count = line,
  Location = seq(beg_region, end_region)
)

head(read_counts_df)

```

```{r}

# Fit a normal distribution to the read counts
mean_read_counts = mean(read_counts_df$Count)
sd_read_counts = sd(read_counts_df$Count)

# Create a histogram of the read counts
p <- ggplot(read_counts_df, aes(x = Count)) +
  geom_histogram(aes(y = ..density..), binwidth = 1, color = "black", fill = "white") +
  stat_function(fun = dnorm, args = list(mean = mean_read_counts, sd = sd_read_counts), color = "red", size = 1) +
  labs(title = "Histogram of Read Counts with Fitted Normal Distribution",
       x = "Number of Reads",
       y = "Density") +
  theme_minimal()

print(p)

```

The histogram shows that the majority of locations have a very low number of reads, mostly clustered around zero, with a right-skewed distribution.

The fitted normal distribution (red line) does not match the histogram well.
The normal distribution is symmetric and bell-shaped, which does not align with the right-skewed nature of the read count distribution.
The histogram's peak is at the beginning (near zero), while the normal distribution's peak is at the mean, leading to a poor fit.
The normal distribution is not suitable for this data due to its right-skewed nature and the heavy concentration of low read counts.

