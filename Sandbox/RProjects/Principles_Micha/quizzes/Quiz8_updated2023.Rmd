---
title: "Quiz 8"
author: "Carmel Baris"
date: "`r Sys.Date()`"
output: 
  bookdown::pdf_book:
    latex_engine: lualatex

header-includes:
  - \usepackage{amsmath}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Introduction to Confidence Interval & Confidence Level

### What is Confidence Level (CL)?
Denoted 1-α, CL is the probability that the real value of the expectancy is within the Confidence Interval range.

### Zehuyot for Confidence Level
a. 1-α = p
b. α = 1-p
c. α/2 = (1-p)/2
d. 1-α/2 = 1-(1-p)/2
e. 1-α/2 = (2-(1-p))/2
f. 1-α/2 = (1+p)/2

Functions below are based on code from Stat's Google-Drive.
```{r , echo=FALSE, warning=FALSE}
#install.packages("docstring")
library(docstring)


#++++++++++++++++++++++++++++++++++++++++
VarianceToSd <- function(x, is_sd=T){
  #' Helper function
  #' 
  #' @param x given variance

  if (is_sd == F){x = sqrt(x)}
  return(x)
}


#++++++++++++++++++++++++++++++++++++++++
rangeConfIntervalZ<-function(n, p, avg, sd, is_sd=T){
  #' CI for Normal distribution with given variance
  #'
  #' The Confidence Interval is calculated using the Z table, i.e.
  #' the cumulative probability function of the standardized norm distr. 
  #'
  #' @param n number of samples
  #' @param p required Confidence Level, 1-α
  #' @param avg mean of all samples, as the expectancy's estimator 
  #' @param sd given standard deviation
  #' @param is_sd F when given variance, otherwise will be treated as sd 

  VarianceToSd(sd,is_sd)
  
  z=qnorm((1+p)/2)
  cat("Confidence interval for a confidence level of:",paste0(p*100,"%"))
  cat("\n lower bound (left border): ", avg-z*(sd/sqrt(n)))
  cat("\n upper bound (right border): ", avg+z*(sd/sqrt(n)))
  cat("\n length is :" , 2*z*sd/sqrt(n))
}

#run example:
rangeConfIntervalZ(n=10 ,sd=12.9 ,p=0.92,avg=75 ,is_sd=F)


#++++++++++++++++++++++++++++++++++++++++
rangeConfIntervalT<-function(n, sd, p, avg, is_sd=T){
  #when given the variance enter F, otherwise will be treated as sd
  #' CI for Normal distribution with unknown variance
  #'
  #' The Confidence Interval is calculated using the T distribution
  #'
  #' @param n number of samples
  #' @param p required Confidence Level, 1-α
  #' @param avg mean of all samples, as the expectancy's estimator 
  #' @param sd estimate of standard deviation
  #' @param is_sd F when given variance, otherwise will be treated as sd 
  
  VarianceToSd(sd,is_sd)
  
  t=qt(((1+p)/2),(n-1)) #quantile of variance estimate
  cat("Confidence interval for a confidence level of:",paste0(p*100,"%"))
  cat("\n lower bound (left border): ", avg-t*(sd/sqrt(n)))
  cat("\n upper bound (right border): ", avg+t*sd/sqrt(n))
  cat("\n length is: " , 2*t*sd/sqrt(n))
  
}

#run example:
rangeConfIntervalT(n= 10,sd= 12.9, p= 0.92, avg=75 ,is_sd=T)
```


```{r ConfidenceLevel, echo=FALSE, warning=FALSE}
#++++++++++++++++++++++++++++++++++++++++
ConfLevel<-function(n,upperb, lowerb=0, sd, is_sd=T){
  #' CL for Normal distribution with given variance
  #'
  #' The Confidence Level is reverse-engineered from the
  #' given bounds of the Confidence Interval
  #'
  #' @param n number of samples
  #' @param upperb upper bound (right), set to length if given
  #' @param lowerb lower bound (left), leave if given length
  #' @param sd given standard deviation
  #' @param is_sd F when given variance, otherwise will be treated as sd 
  
  VarianceToSd(sd, is_sd)
  
  L=upperb-lowerb
  p= 2*pnorm( L*sqrt(n) / (2*sd) ) -1
  
  
  cat(" Confidence Level's quantile: 1-α = ", round(p,3))
  cat("\n Confidence Level that was used: ", paste0(round(p,3)*100,"%"))
  cat("\n Confidence interval length is : ", L)
}

#run example:
ConfLevel(n= 20, sd= 5, upperb=4, lowerb=0, is_sd=T)
```


# Question 1: Light Bulbs

ran.var ~ N[θ, σ=sqrt(918)] #shelf life with unknown expectancy

Find upper bound of confidence interval, with a confidence level of 0.94.

Answer to a precision of two digits after the period

FORMULA: CI UPPPER BOUND
unbiased.estimator + qnorm(p= 1-α/2) * σ/sqrt(n)

```{r light_bulbs, echo=TRUE}
#GIVEN DATA
q1..unbiased.est = 500 #hours, avg(shelf life)
q1..1minusα = 0.94 #quantile of required confidence level
q1..α = 1 - q1..1minusα #required max standard error
q1..σ = sqrt(918)
q1..n = 36 #sample size, number of light bulbs in sample

#CALCULATE
q1..ans <-
  q1..unbiased.est + qnorm(1-0.5*q1..α) * q1..σ/sqrt(q1..n)
round(q1..ans, 3)

```


# Question 3: Probability of T Distribution

ran.var ~ t(df=14)

Find P[X ≤ CL], for CL = 1-α = 1.64

Answer to a precision of three digits after the period

```{r t_distr, echo=TRUE}
#GIVEN DATA
q3..1minusα = 1.64 #quantile of required confidence level
q3..df = 46 #degrees of freedom

#CALCULATE
q3..ans <- pt(q=q3..1minusα, df=q3..df)
round(q3..ans, 4)

```

# Question 4: Quantile of T Distribution
```{r, t_distr_4, echo=TRUE}
#GIVEN DATA
q4..1minusα = 0.62 #quantile of required confidence level
q4..df = 62 #degrees of freedom

#CALCULATE
q4..ans <- qt(p=q4..1minusα, df=q4..df)
round(q4..ans, 3)

```


# Question 5: CI of Bamba Weight
FORMULA: Length of CI
2 * qt(p= 1-α/2, df) * est.σ/sqrt(n)

```{r, t_distr_5, echo=TRUE}
#GIVEN DATA
q5..1minusα = 0.92 #quantile of required confidence level
q5..α = 1 - q5..1minusα #required max standard error
q5..n = 10 #sample size
q5..df = q5..n-1 #degrees of freedom
q5..est.σ = 12
q5..unbiased.est = 75 #avg(package weight)

#CALCULATE
q5..ans <- 2 * qt(p=1-0.5*q5..α, df=q5..df) * q5..est.σ/sqrt(q5..n)
round(q5..ans, 3)

```

# Question 6: New Sample, Missing Info
We are told that a new population sample was conducted. 
Because the sample changed, variance & mean (estimator) change.
We cannot deduce the new CI length.


# Question 7: Proportion of TV Show Viewers
We'll try to reverse-engineer the process used to calculate the given Confidence Interval `[lower=0.45, upper=0.65]`.

Let us denote *p* as the unbiased estimator for the proportion of viewers that watch the aforementioned TV show (Bernoulli-distributed).

Assuming *p* is a known number, we'll calculate the upper and lower bounds of the Confidence Interval:

### CI UPPER BOUND FORMULA

$$ 

\begin{cases}
  
  R_1:= upper = p + qnorm(p= 1- \frac{α}{2}) \cdot p(1-p) \cdot \frac{1}{ \sqrt n}\\
  R_2:= lower = p - qnorm(p= 1- \frac{α}{2}) \cdot p(1-p) \cdot \frac{1}{ \sqrt n}\\

\end{cases}

$$


$$

\begin{cases}

\Downarrow R_1 + R_2 \Downarrow \\

  upper + lower = 2p \Rightarrow p 
  = \frac{upper+lower}{2} 
  = \frac{0.45+0.65}{2}
  = 0.55
\end{cases}

$$
Note that we did not need to know the values of $\alpha$ nor *n*.


### SIDENOTE: LENGTH OF CI FORMULA
Combining the two formulas above, we can create a single formula.
By inserting the given values of the confidence interval, we can compute *p*:

$$
\begin{aligned} 

\text {CI length := } 
&  upper-lower = 2 \cdot qnorm(p= 1- \frac{α}{2}) \cdot p(1-p) \cdot \frac{1}{ \sqrt n} \\
& \Leftrightarrow p(1-p) = \frac{0.5 \cdot { \sqrt n} 
\cdot (upper-lower)}{qnorm(p= 1- \frac{α}{2})}

\end{aligned}
$$

