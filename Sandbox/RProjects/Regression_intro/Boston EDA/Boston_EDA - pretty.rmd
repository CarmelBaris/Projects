---
title: "Targil 4"
output: html_document
---

# Background
The Boston housing dataset investigates the link between housing prices in the Boston region and various attributes: an attribute indicating environmental pollution, structural and accessibility attributes at the property level, as well as socioeconomic and demographic attributes at the neighborhood level. The dataset uses standardized geographic regions called census tracts, as they were defined by the United States Census Bureau of 1970.

```{r, echo=FALSE, warning=FALSE}
# install.packages("MASS")
# install.packages("knitr")
# install.packages("rlang", dependencies = TRUE)
# install.packages("ggplot2")
# install.packages("ggcorrplot")
# install.packages("gridExtra")


```

# a. Loading the data
```{r}
# Load data
library(MASS)
```

# b. Subsetting variables of interest
Removing the categorical variables ('chas', 'rad').
```{r}
# Create data frame
df <- data.frame(
  # structural variables
  rm = Boston$rm,
  age = Boston$age,
  # accessibility variables
  dis = Boston$dis,
  # neighborhood variables
  tax = Boston$tax,
  zn = Boston$zn,
  indus = Boston$indus,
  crim = Boston$crim,
  ptratio = Boston$ptratio,
  lstat = Boston$lstat,
  b = Boston$b,
  # air pollution variable
  nox = Boston$nox,
  # dependent variable
  medv = Boston$medv
)
```

# c. Describing the variables
```{r}
# Create function to calculate statistics, returns vector
my_summary <- function(x) {
  c(
    min = min(x, na.rm = TRUE),
    quantile(x, probs = 0.25, na.rm = TRUE),
    median = median(x, na.rm = TRUE),
    mean = mean(x, na.rm = TRUE),
    quantile(x, probs = 0.75, na.rm = TRUE),
    max = max(x, na.rm = TRUE),
    sd = sd(x, na.rm = TRUE)
  )
}

# Apply function to each attribute in the data frame
stats <- apply(df, 2, my_summary)
stats <- round(stats, digits = 2)

# Convert results to data frame and transpose
results <- t(as.data.frame(stats))
```
```{r, echo=FALSE, warning=FALSE}
# Assign custom column names
colnames(results) <- c("Min", "Q1", "Median", "Mean", "Q3", "Max", "SD")

# Assign custom row names
rownames(results) <- c(
        # structural variables
        "Avg. number of rooms, per property",
        "Properties built before 1940, prop. per town",
        # accessibility variables
        "Dist. to employment centers, per property (in miles)",
        # neighborhood variables
        "Tax, rate per $10,000 est. property value per town (in $)",
        "Residential land zone, prop.per town (in acres)",
        "Non-retail business zone, prop.per town (in acres)",
        "Crimes reported, rate per person per town",
        "Pupil-teacher, ratio per school district per town",
        "Lower socioeconomic residents, prop. per town",
        "Black residents, prop. per town",
        # air pollution variable
        "Nitrogen oxide pollution (in parts per hundred million)",
        # the dependent variable
        "Median value of property")

# Print updated results
library(knitr)
kable(results, format = "markdown")


```

# d. Correlation matrix
```{r, echo=FALSE, warning=FALSE}
library(rlang)
library(ggplot2)
library(ggcorrplot)

## create the correlation matrix between all variables in the Boston Dataset
corr_boston <- cor(df)

# visualize the matrix (lower triangle with labels of correlation coefficients)
ggcorrplot(corr_boston, hc.order = TRUE, type = "lower", lab = TRUE, lab_size = 3, insig = "blank")
```





# e. Explanatory variables of housing prices in Boston
When cross-referenced with the median property value, the two variables that yielded the highest absolute correlation were:

a) Average number of rooms ('rm'), with a positive correlation of 0.7.

b) Proportion of residents that belong to a lower socioeconomic class ('lstat'), with a negative correlation of (-0.74).

This conclusion is reinforced by the individual scatter plots of each explanatory variable against the median property values (below):

a) The higher the town's average number of rooms per property, the higher the median property value.

b) The lower the proportion of lower-class residents in a town, the lower the median property value.

```{r, warning=FALSE}
library(gridExtra)

# medv against rm scatterplot
plot1 <- ggplot(Boston, aes(x = rm, y = medv)) + geom_point(size = 2)

# medv against lstat scatterplot
plot2 <- ggplot(Boston, aes(x = lstat, y = medv)) + geom_point(size = 2)

# display plots side by side
grid.arrange(plot1, plot2, ncol = 2)

```


Note several outlier observations at the highest end of the median value range (y-axis). Their value remains the highest regardless of the number of rooms or proportion of lower-class residents in the neighborhood. It's possible that once the property value is above a certain threshold, changes in the above-mentioned explanatory variables do not exclusively account for changes in the housing price. This may call for further investigation in a follow-up analysis.